<img src="logo/falconLogo.png" alt="falcon logo" style="border:none" />

This repository contains data and scripts for a collation processing workflow, and it's evaluation.

<!-- TODO: name to be altered-->
- `falcon`: Python code;
- `data`: contains pre-processed data (sources in txt or xml), input data, and manually annotated validation data for comparison.


## Installing

```bash
# Recommended steps (use virtualenv)
virtualenv env -p python3.8
source env/bin/activate
# end recommended steps

# begin install
pip install -r requirements.txt
```

### Language models with pie-extended

Models will be installed automatically if they are not. 

You can get a list of available models with

```bash
pie-extended list
```

## Sample usage

```bash
# Lemmatise raw (txt) files for ulterior collation
python3 main.py <path> [--lemmatise] [--lang] [--engine]

# Collate annotated files in XML
# containing (possibly human-corrected) linguistic information
python3 main.py <path> [--collate]

# Or, alternatively, do it all in one row
python3 main.py <path> [--lemmatise] [--lang] [--engine] [--collate]
```

To evaluate the results:

```bash
python eval.py <path_to_gt> <path_to_results> [--print_diff]
# e.g., evaluate Alexis results
python eval.py data/eval/alexis/gt.xml data/eval/alexis/simple.xml
```

For simple collation from the txt sources, without preprocessing:

```bash
python main.py <path> [--simple]
# e.g., evaluate Alexis results
python main.py data/eval/alexis/sources --simple
```


More info about usage and examples are available <a href="#info">below</a>.

## Format for XML annotated files

If you want to use directly XML annotated files,
they must be in TEI, and contain `<w>` tags,
with `@lemma`, and possibly `@pos` and `@msd` tags,

```xml
<w 
  lemma="mëisme" 
  pos="ADJind" 
  msd="NOMB.=s|GENRE=m|CAS=r"
>meisme</w>
```
Or, possibly, use an `@type`,

```xml
<w 
  lemma="mëisme"
  type="ADJind|NOMB.=s|GENRE=m|CAS=r"
>meisme</w>
```


<span id="info"></span>
## Examples and usage additional info

### Lemmatisation

```bash
# Lemmatise raw (txt) files for ulterior collation
python3 main.py <path> [--lemmatise] [--lang] [--engine]
```

This step takes txt files and produces annoted XML files.

The options currently available for the language and the engine are:

old French annotated using [Pie](https://github.com/emanjavacas/pie), as in this example
```bash
python3 main.py data/input/chevLyon/sources --lemmatise --lang fro --engine pie
```


### Collation

```bash
# Collate annotated files in XML
# containing (possibly human-corrected) linguistic information
python3 main.py <path> [--collate]
```

This step takes XML files and collate them. The results are saved in XML and in txt in the text directory. Here it is an example

```bash
python3 main.py data/input/chevLyon/sources --collate
```

Before collating, you might want to correct the XML generated by the previous step. For avoiding over-writing, move the XML files to a new directory before editing them and edit the path accordingly before launching the command.

### All together

```bash
python3 main.py <path> [--lemmatise] [--lang] [--engine] [--collate]
```

For example
```bash
python3 main.py data/input/chevLyon/sources --lemmatise --lang fro --engine pie --collate
```
